<!doctype html>
<html lang="utf-8">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <title>Hello, world!</title>
</head>
<body style="margin:0px;">
    <div>
    </div>
    <div>
        <iframe id="frame" src="http://toscamp.com/map/mapviewer.php?map=d_velniasprison_trackzone&amplang=kr" width="1183px" height="900px">
        </iframe>
    </div>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
            src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous"></script>
<script>
    $(document).ready(function(){
       setInterval(getData, 450);
    });
    var candidates = [];
    var lastKey = null;
    function getData() {
        console.log("get data");
        $.ajax({
            url:'/api/map/information',
            dataType: 'json',
            success:function(data){
                console.log(data)
                if (data.code == 0) {
                    candidates.push(data.informations);
                    if(candidates.length >= 3){
                        var flatcandidates = candidates.flat();
                        var map = new Map();
                        for (var i=0; i<flatcandidates.length; i++){
                            var key = flatcandidates[i].realName+"###"+flatcandidates[i].url;
                            console.log(key);
                            if (map.containsKey(key)) {
                                map.put(key, map.get(key) + 1);
                            }
                            else
                                map.put(key,1);

                            console.log(key + " "+ map.get(key) + 1)
                        }
                        var maxCount=0;
                        var maxKey=null;
                        var keys=map.keys();
                        for (var i=0; i<keys.length; i++){
                            if (maxCount <= map.get(keys[i])) {
                                maxCount = map.get(keys[i]);
                                maxKey = keys[i];
                            }
                        }
                        //candidates
                        if (maxCount > 0 && lastKey!= maxKey) {
                            $('#frame').attr('src', maxKey.split("###")[1])
                            lastKey=maxKey;
                        }
                        candidates=[]
                    }
                } else {
                    candidates = []
                }
            },
            error:function (e) {
                console.log(e);
            }
        })
    }
    Map = function(){
        this.map = new Object();
    };
    Map.prototype = {
        put : function(key, value){
            this.map[key] = value;
        },
        get : function(key){
            return this.map[key];
        },
        containsKey : function(key){
            return key in this.map;
        },
        containsValue : function(value){
            for(var prop in this.map){
                if(this.map[prop] == value) return true;
            }
            return false;
        },
        isEmpty : function(key){
            return (this.size() == 0);
        },
        clear : function(){
            for(var prop in this.map){
                delete this.map[prop];
            }
        },
        remove : function(key){
            delete this.map[key];
        },
        keys : function(){
            var keys = new Array();
            for(var prop in this.map){
                keys.push(prop);
            }
            return keys;
        },
        values : function(){
            var values = new Array();
            for(var prop in this.map){
                values.push(this.map[prop]);
            }
            return values;
        },
        size : function(){
            var count = 0;
            for (var prop in this.map) {
                count++;
            }
            return count;
        }
    };
</script>
</body>
</html>